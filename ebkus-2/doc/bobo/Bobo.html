<html>
<head><title>Bobo</title></head>
<body>

<dl><dt><h1>Bobo</h1>
<dd>Python Object Publisher -- Publish Python objects on web servers</dl>
<h1>Description</h1>

<h2>Introduction</h2>
<p>  The Python object publisher provides a simple mechanism for publishing a
  collection of Python objects as World-Wide-Web (Web) resources without any
  plumbing (e.g. CGI) specific code.</p>


<h2>Benefits</h2>
<ul><li><p>Applications do not have to include code for interfacing with the
    web server.</p>


<li><p>Applications can be moved from one publishing mechanism, such as
    CGI, to another mechanism, such as Fast CGI or COM, with no change.</p>


<li><p>Python objects are published as Python objects.  The web server
    "calls" the objects in much the same way that other Python objects
    would.</p>


<li><p>Automatic conversion of URL to object/sub-object traversal.</p>


<li><p>Automatic marshaling of form data, cookie data, and request
    meta-data to Python function arguments.</p>


<li><p>Automated exception handling.</p>


<li><p>Automatic generation of CGI headers.</p>


<li><p>Automated authentication and authorization.</p>

</ul>

<h2>Published objects</h2>
<p>  Objects are published by including them in a published module.
  When a module is published, any objects that:</p>
<ul><li><p>can be found in the module's global name space,</p>


<li><p>that do not have names starting with an underscore,</p>


<li><p>that have non-empty documentation strings, and</p>


<li><p>that are not modules</p>

</ul>

<p>  are published.</p>

<p>  Sub-objects (or sub-sub objects, ...) of published objects are
  also published, as long as the sub-objects:</p>
<ul><li><p>have non-empty doc strings,</p>


<li><p>have names that do not begin with an underscore, and</p>


<li><p>are not modules.</p>

</ul>

<p>  Note that object methods are considered to be subobjects.</p>

<p>  Object-to-subobject traversal is done by converting steps in the URI
  path to get attribute or get item calls.  For example, in traversing
  from <code>http://some.host/some_module/object</code> to
  <code>http://some.host/some_module/object/subobject</code>, the module
  publisher will try to get <code>some_module.object.subobject</code>.  If the
  access fails with other than an attribute error, then the object
  publisher raises a "NotFound" exception.  If the access fails with
  an attribute error, then the object publisher will try to obtain the
  subobject with: <code>some_module.object["subobject"]</code>.  If this access
  fails, then the object publisher raises a <code>"Not Found"</code> exception.  If
  either of the accesses suceeds, then, of course, processing continues.</p>

<p>  During object traversal, the names <code>.</code> and <code>..</code> have special meaning
  if the application does not provide meaning for them.  If the name
  <code>.</code> is encountered and the application does not provide a value,
  then the name is effectively skipped.  For example, the path <code>x/./y</code>
  is equivalent to <code>x/y</code>. If the name <code>..</code> is encountered and the
  application does not provide a value, then the parent of the object
  being traversed is used.  For example, <code>x/y/../z</code> is almost
  equivalent to <code>x/z</code>, except that <code>y</code> is considered to be part of the
  path to <code>z</code>.  If <code>y</code> has a user folder, it will be consulted when
  validadting access to <code>z</code> before a user folder in <code>x</code> is consulted.</p>

<p>  Normally, URL traversal begins with the published module.  If the
  Published module has a global variable named <code>bobo_application</code>,
  then traversal begins with this object instead.</p>

<p>  If the final object encountered when traversing the URL has an
  <code>index_html</code> attribute, the object traversal will continue to this
  attribute.   This is useful for providing default methods for objects.</p>


<h2>Access Control</h2>
<p>  Object access can be further controlled via
  <em>roles</em> and <em>user databases</em>.</p>

<p>  The Bobo authorization model uses roles to control access to
  objects.  As Bobo traverses URLs, it checked for <code>__roles__</code>
  attributes in the objects it encounters.  The last value found
  controls access to the published object.</p>

<p>  If found, <code>__roles__</code> should be None or a sequence of role names.  If
  <code>__roles__</code> is <code>None</code>, then the published object is public.  If
  <code>__roles__</code> is not <code>None</code>, then the user must provide a user name and
  password that can be validated by a user database.</p>

<h3>User Databases</h3>
<p>     If an object has a <code>__roles__</code> attribute that is not empty and not
     <code>None</code>, Bobo tries to find a user database to authenticate the user.
     It searches for user databases by looking for an <code>__allow_groups__</code>
     attribute, first in the published object, then in it's container,
     and so on until a user database is found.  When a user database
     is found, Bobo attempts to validate the user against the user
     database.  If validation fails, then Bobo will continue searching
     for user databases until the user can be validated or until no
     more user databases can be found.</p>

<h4>User database objects</h4>
<p>       The user database may be an object that provides a validate method:</p>
<PRE>
         validate(request, http_authorization, roles)

</PRE>

<p>       where:</p>
<dl><dt>          <code>request</code><dd><p>a mapping object that contains request information,</p>


<dt>          <code>http_authorization</code><dd><p>the value of the HTTP Authorization header
                   or <code>None</code> if no authorization header was provided, and </p>


<dt>          <code>roles</code><dd><p>a list of user role names</p>

</dl>

<p>       The validate method returns <code>None</code> if it cannot validate a user and
       a user object if it can.  Normally, if the validate method returns
       <code>None</code>, Bobo will try to use other user databases, however, a user
       database can prevent this by raising an exception.</p>

<p>       If validation succeeds Bobo assigns the user object to the
       request variable, <code>AUTHENTICATED_USER</code>.  Bobo currently places
       no restriction on user objects.</p>


<h4>Mapping user databases</h4>
<p>       If the user database is a mapping object, then the keys of the
       object are role names and values are the associated user groups for
       the roles.   Bobo attempts to validate the user by searching
       for a user name and password matching the user name and
       password given in the HTTP Authorization header in a groups for
       role names matching the roles in the published object's
       __roles__ attribute.</p>

<p>       If validation succeeds Bobo assigns the user name to the
       request variable, <code>AUTHENTICATED_USER</code>.</p>


<h4>Authentication user interface</h4>
<p>       When a user first accesses a protected object, Bobo returns an
       error response to the web browser that causes a password dialog
       to be displayed. </p>


<h4>Specifying a realm name for basic authentication</h4>
<p>       You can control the realm name used for Bobo's Basic
       authentication by providing a module variable named
       <code>__bobo_realm__</code>.</p>


<h4>Using the web server to perform authentication</h4>
<p>       Some web servers cannot be coaxed into passing authentication
       information to applications.  In this case, Bobo applications
       cannot perform authentication.  If the web server is configured
       to authenticate access to a Bobo application, then the Bobo
       application can still perform authorization using the
       <code>REMOTE_USER</code> variable.  Bobo does this automatically when
       mapping user databases are used, and custom user databases may
       do this too.</p>

<p>       In this case, it may be necessary to provide more than one path
       to an application, one that is authenticated, and one that
       isn't, if public methods and non-public methods are
       interspursed.</p>



<h3>Fixed-attribute objects</h3>
<p>      For some interesting objects, such as functions, and methods,
      it may not be possible for applications to set
      <code>__roles__</code> attributes.  In these cases, the
      object's parent object may contain attribute
      <code>object_name__roles__</code>, which
      will be used as surrogates for the object's
      <code>__role__</code> attribute.</p>



<h2>Function, method, and class objects</h2>
<p>  If a published object is a function, method, or class, then the
  object will be called and the return value of the call will be
  returned as the HTTP resonse.  Calling arguments will be supplied
  from "environment variables", from URL-encoded form data, if any,
  and from HTTP cookies by matching argument names defined for the
  object with variable names.</p>

<h3>Accessing request data directly</h3>
<p>    If the object being called has an argument named <code>REQUEST</code>, then
    a request object will be passed.  Request objects encapsulate
    request meta data and provide full access to all environment
    data, form data, cookies, and the input data stream (i.e. body
    data as a stream).</p>


<h3>Providing finer control over responses and stream output</h3>
<p>    If the object being called has an argument named <code>RESPONSE</code>,
    then a response object will be passed.  This object can be used
    to specify HTTP headers and to perform stream-oriented output.
    Rather than returning a result, data may be output by calling
    the write and flush methods of the response object one or more
    times.  This is useful, for example, when outputing results from
    a time-consuming task, since partial results may be displayed
    long before complete results are available.</p>


<h3>Argument Types and File upload</h3>
<p>    Normally, string arguments are passed to called objects. The
    called object must be prepared to convert string arguments to
    other data types, such as numbers.</p>

<p>    If file upload fields are used, however, then FileUpload objects
    will be passed instead for these fields.  FileUpload objects
    bahave like file objects and provide attributes for inspecting the
    uploaded file's source name and the upload headers, such as
    content-type. </p>

<p>    If field names in form data are of the form: name:type, then an
    attempt will be to convert data from from strings to the indicated
    type.  The data types currently supported are: </p>
<dl><dt>        float<dd><p>Python floating point numbers</p>


<dt>        int<dd><p>Python integers</p>


<dt>        long<dd><p>Python long integers</p>


<dt>        string<dd><p>python strings</p>


<dt>        required<dd><p>non-blank python strings</p>


<dt>        date<dd><p>Date-time values</p>


<dt>        list<dd><p>Python list of values, even if there is only
                one value.</p>


<dt>        lines<dd><p>Python list of values entered as multiple lines
                 in a single field</p>


<dt>        tokens<dd><p>Python list of values entered as multiple space-separated
                  tokens in a single field</p>


<dt>        tuple<dd><p>Python tuple of values, even if there is only one.</p>


<dt>        method<dd><p>Augment PATH_INFO with information from the form field.
                  (See "Method Arguments" blow.)</p>

</dl>

<p>    For example, if the name of a field in an input
    form is <code>age:int</code>, then the field value will be passed in argument,
    age, and an attempt will be made to convert the argument value to
    an integer.  This conversion also works with file upload, so using
    a file upload field with a name like myfile:string will cause the
    UploadFile to be converted to a string before being passed to the
    object.  </p>


<h3>Method Arguments</h3>
<p>    Sometimes, it is desireble to control which method is called based
    on form data.  For example, one might have a form with a select
    list and want to choose which method to call depening on the item
    chosen. Similarly, one might have multiple submit buttons and want
    to invoke a different method for each button.</p>

<p>    Bobo provides a way to select methods using form variables through
    use of the "method" argument type.  The method type allows the
    request <code>PATH_INFO</code> to be augmented using information from a
    form item name or value.</p>

<p>    If the name of a form field is <code>:method</code>, then the value of the
    field is added to <code>PATH_INFO</code>.  For example, if the original
    <code>PATH_INFO</code> is <code>foo/bar</code> and the value of a <code>:method</code> field is
    <code>x/y</code>, then <code>PATH_INFO</code> is transformed to <code>foo/bar/x/y</code>.  This is
    useful when presenting a select list.  Method names can be
    placed in the select option values.</p>

<p>    If the name of a form field ends in <code>:method</code> and is longer than 7
    characters, then the part of the name before <code>:method</code> is added to
    <code>PATH_INFO</code>.  For example, if the original <code>PATH_INFO</code> is
    <code>foo/bar</code> and there is a <code>x/y:method</code> field, then <code>PATH_INFO</code> is
    transformed to <code>foo/bar/x/y</code>.  In this case, the form value is
    ignored.  This is useful for mapping submit buttons to methods,
    since submit button values are displayed and should, therefore,
    not contain method names.</p>

<p>    Only one method field should be provided.  If more than one method
    field is included in the request, the behavior is undefined.</p>

<p>    The base HREF is set when method fields are provided.  In the
    above examples, the base HREF is set to <code>.../foo/bar/x</code>.  Of
    course, if, in this example, <code>y</code> was an object with an index_html
    method, then the base HREF would be reset to <code>.../foo/bar/x/y</code>.</p>



<h2>Published objects that are not functions, methods, or classes</h2>
<p>  If a published object that is not a function, method, or class
  is accessed, then the object itself will be returned.</p>


<h2>Return types</h2>
<p>  A published object, or the returned value of a called published
  object can be of any Python type.  If the returned value has an
  <code>asHTML</code> method, then this method will be called to convert the
  object to HTML, otherwise the returned value will be converted to a
  string and examined to see if it appears to be an HTML document.  If
  it appears to be an HTML document, then the response content-type
  will be set to <code>text/html</code>.  Otherwise the content-type will be set
  to <code>text/plain</code>.</p>

<p>  If the returned object is None or the string representation of the
  returned object is an empty string, then the HTTP return status will
  be set to "No Content", and no body will be returned.  On some
  browsers, this will cause the displayed document to be unchanged.</p>


<h2>Base References</h2>
<p>  In general, in Bobo, relative URL references should be interpreted
  relative to the parent of the published object, to make it easy for
  objects to provide links to siblings.</p>

<h3>If</h3>
<ul><li><p>the result of a request is HTML text,</p>


<li><p>the text does not define a <code>base</code> tag in the <code>head</code> portion of
     the HTML, and</p>


<li><p>The published object had an <code>index_html</code> attribute that was not included
     in the request URL,</p>

</ul>

<p>  then a base reference will be inserted that is the URL of the
  published object.</p>


<h2>Exception handling</h2>
<p>  Unhandled exceptions are caught by the object publisher
  and are translated automatically to nicely formatted HTTP output.</p>

<p>  When an exception is raised, the exception type is mapped to an HTTP
  code by matching the value of the exception type with a list of
  standard HTTP status names.  Any exception types that do not match
  standard HTTP status names are mapped to "Internal Error" (500).
  The standard HTTP status names are: <code>"OK"</code>, <code>"Created"</code>,
  <code>"Accepted"</code>, <code>"No Content"</code>, <code>"Multiple Choices"</code>, <code>"Redirect"</code>,
  <code>"Moved Permanently"</code>, <code>"Moved Temporarily"</code>, <code>"Not Modified"</code>,
  <code>"Bad Request"</code>, <code>"Unauthorized"</code>, <code>"Forbidden"</code>, <code>"Not Found"</code>,
  <code>"Internal Error"</code>, <code>"Not Implemented"</code>, <code>"Bad Gateway"</code>, and
  <code>"Service Unavailable"</code>, Variations on these names with different
  cases and without spaces are also valid.</p>

<p>  An attempt is made to use the exception value as the body of the
  returned response.  The object publisher will examine the exception
  value.  If the value is a string that contains some white space,
  then it will be used as the body of the return error message.  It it
  appears to be HTML, the the error content type will be set to
  <code>text/html</code>, otherwise, it will be set to <code>text/plain</code>.  If the
  exception value is not a string containing white space, then the
  object publisher will generate it's own error message.</p>

<p>  There are two exceptions to the above rule:</p>
<ol><li><p>If the exception type is: <code>"Redirect"</code>, <code>"Multiple Choices"</code>
       <code>"Moved Permanently"</code>, <code>"Moved Temporarily"</code>, or
       <code>"Not Modified"</code>, and the exception value is an absolute URI,
       then no body will be provided and a <code>Location</code> header will be
       included in the output with the given URI.</p>


<li><p>If the exception type is <code>"No Content"</code>, then no body will be
       returned.</p>

</ol>

<p>  When a body is returned, traceback information will be included in a
  comment in the output.  The module variable
  <code>__bobo_hide_tracebacks__</code> can be used to control how tracebacks are
  included.  If this variable and false, then tracebacks are included
  in PRE tags, rather than in comments.  This is very handy during
  debugging. </p>


<h2>Redirection</h2>
<p>  Automatic redirection may be performed by a published object
  by raising an exception with a type and value of "Redirect" and
  a string containing an absolute URI.</p>


<h2>The default object</h2>
<p>  If no object is specified in a URI, then the publisher will try to
  publish the object <code>index_html</code>, if it exists, otherwise the module's
  doc string will be published.</p>


<h2>Pre- and post-call hooks</h2>
<p>  If a published module defines objects <code>__bobo_before__</code> or
  <code>__bobo_after__</code>, then these functions will be called before 
  or after a request is processed.  One possible use for this is to
  acquire and release application locks in applications with
  background threads.</p>


<h2>Publishing a module using CGI</h2>
<ul><li><p>Do not copy the module to be published to the cgi-bin
      directory.</p>


<li><p>Copy the files: cgi_module_publisher.pyc and CGIResponse.pyc
      to the directory containing the module to be published, or to a
      directory in the standard (compiled in) Python search path.</p>


<li><p>Copy the file cgi-module-publisher to the directory containing the
      module to be published.</p>


<li><p>Create a symbolic link from cgi-module-publisher (in the directory
      containing the module to be published) to the module name in the
      cgi-bin directory.</p>

</ul>
<p></p>





<h1>Class FileUpload</h1>

<p>    File upload objects</p>

<p>    File upload objects are used to represent file-uploaded data.</p>

<p>    File upload objects can be used just like files.</p>

<p>    In addition, they have a <code>headers</code> attribute that is a dictionary
    containing the file-upload headers, and a <code>filename</code> attribute
    containing the name of the uploaded file.
    </p>




<h1>Class Request</h1>

<p>    Model HTTP request data.</p>

<p>    This object provides access to request data.  This includes, the
    input headers, form data, server data, and cookies.</p>

<p>    Request objects are created by the object publisher and will be
    passed to published objects through the argument name, REQUEST.</p>

<p>    The request object is a mapping object that represents a
    collection of variable to value mappings.  In addition, variables
    are divided into four categories:</p>
<ul><li><p>Environment variables</p>
<p>        These variables include input headers, server data, and other
        request-related data.  The variable names are as <a
        href="http://hoohoo.ncsa.uiuc.edu/cgi/env.html">specified</a>
        in the <a
        href="http://hoohoo.ncsa.uiuc.edu/cgi/interface.html">CGI
        specification</a></p>



<li><p>Form data</p>
<p>        These are data extracted from either a URL-encoded query
        string or body, if present.</p>



<li><p>Cookies</p>
<p>        These are the cookie data, if present.</p>



<li><p>Other</p>
<p>        Data that may be set by an application object.</p>


</ul>

<p>    The form attribute of a request is actually a Field Storage
    object.  When file uploads are used, this provides a richer and
    more complex interface than is provided by accessing form data as
    items of the request.  See the FieldStorage class documentation
    for more details.</p>

<p>    The request object may be used as a mapping object, in which case
    values will be looked up in the order: environment variables,
    other variables, form data, and then cookies.
    </p>


<dl><dt><p><strong>General Services Provided by Request</strong></p><dd>

<dl><dt><strong>`aRequest`</strong><dd>
<p>Convert a Request to a string that looks like a Python expression.</p>


</dl>
<dl><dt><strong>str(aRequest)</strong><dd>
<p>Convert a Request to a string.</p>


</dl>
</dl>

<dl><dt><p><strong>Attribute Access Services Provided by Request</strong></p><dd>

<dl><dt><strong>aRequest.name</strong><dd>
<h3>Get a variable value</h3>
<p>        Return a value for the required variable name.
        The value will be looked up from one of the request data
        categories. The search order is environment variables,
        other variables, form data, and then cookies. </p>
<p>        </p>




</dl>
</dl>

<dl><dt><p><strong>Indexing Services Provided by Request</strong></p><dd>

<dl><dt><strong>aRequest[key]</strong><dd>
<h3>Get a variable value</h3>
<p>        Return a value for the required variable name.
        The value will be looked up from one of the request data
        categories. The search order is environment variables,
        other variables, form data, and then cookies. </p>
<p>        </p>




</dl>
<dl><dt><strong>aRequest[key]=value</strong><dd>
<h3>Set application variables</h3>
<p>        This method is used to set a variable in the requests "other"
        category.
        </p>



</dl>
</dl>



<h1>Class Response</h1>

<p>    An object representation of an HTTP response.</p>

<p>    The Response type encapsulates all possible responses to HTTP
    requests.  Responses are normally created by the object publisher.
    A published object may recieve the response abject as an argument
    named <code>RESPONSE</code>.  A published object may also create it's own
    response object.  Normally, published objects use response objects
    to:</p>

<ul><li><p>Provide specific control over output headers,</p>


<li><p>Set cookies, or</p>


<li><p>Provide stream-oriented output.</p>

</ul>
<p>    If stream oriented output is used, then the response object
    passed into the object must be used.
    </p>


<dl><dt><p><strong>Constructor For Response</strong></p><dd>

<dl><dt><strong>Response([body, status, headers, stdout, stderr])</strong><dd>
<p>
        Creates a new response. In effect, the constructor calls
        "self.setBody(body); self.setStatus(status); for name in
        headers.keys(): self.setHeader(name, headers[name])"
        </p>


</dl>
</dl>

<dl><dt><p><strong>Instance Methods For Response</strong></p><dd>

<dl><dt><strong>redirect(location)</strong><dd>
<p>Cause a redirection without raising an error</p>


</dl>
<dl><dt><strong>setCookie(name, value)</strong><dd>
<p>
        Set an HTTP cookie on the browser</p>

<p>        The response will include an HTTP header that sets a cookie on
        cookie-enabled browsers with a key "name" and value
        "value". This overwrites any previously set value for the
        cookie in the Response object.
        </p>


</dl>
<dl><dt><strong>appendHeader(name, value, [delimiter])</strong><dd>
<p>
        Append a value to a cookie</p>

<p>        Sets an HTTP return header "name" with value "value",
        appending it following a comma if there was a previous value
        set for the header. </p>


</dl>
<dl><dt><strong>getStatus()</strong><dd>
<p>Returns the current HTTP status code as an integer. </p>


</dl>
<dl><dt><strong>setHeader(name, value)</strong><dd>
<p>
        Sets an HTTP return header "name" with value "value", clearing
        the previous value set for the header, if one exists. </p>


</dl>
<dl><dt><strong>appendCookie(name, value)</strong><dd>
<p>
        Returns an HTTP header that sets a cookie on cookie-enabled
        browsers with a key "name" and value "value". If a value for the
        cookie has previously been set in the response object, the new
        value is appended to the old one separated by a colon. </p>


</dl>
<dl><dt><strong>getBody()</strong><dd>
<p>Returns a string representing the currently set body. </p>


</dl>
<dl><dt><strong>getHeader(name)</strong><dd>
<p>
         Get a header value</p>

<p>         Returns the value associated with a HTTP return header, or
         "None" if no such header has been set in the response
         yet. </p>


</dl>
<dl><dt><strong>setBody(body, [title, bogus_str_search])</strong><dd>
<p>
        Set the body of the response</p>

<p>        Sets the return body equal to the (string) argument "body". Also
        updates the "content-length" return header.</p>

<p>        You can also specify a title, in which case the title and body
        will be wrapped up in html, head, title, and body tags.</p>

<p>        If the body is a 2-element tuple, then it will be treated
        as (title,body)
        </p>


</dl>
<dl><dt><strong>setBase(base)</strong><dd>
<p>Set the base URL for the returned document.</p>


</dl>
<dl><dt><strong>expireCookie(name)</strong><dd>
<p>
        Cause an HTTP cookie to be removed from the browser</p>

<p>        The response will include an HTTP header that will remove the cookie
        corresponding to "name" on the client, if one exists. This is
        accomplished by sending a new cookie with an expiration date
        that has already passed. Note that some clients require a path
        to be specified - this path must exactly match the path given
        when creating the cookie. The path can be specified as a keyword
        argument.
        </p>


</dl>
<dl><dt><strong>setStatus(status, [reason])</strong><dd>
<p>
        Sets the HTTP status code of the response; the argument may
        either be an integer or a string from { OK, Created, Accepted,
        NoContent, MovedPermanently, MovedTemporarily,
        NotModified, BadRequest, Unauthorized, Forbidden,
        NotFound, InternalError, NotImplemented, BadGateway,
        ServiceUnavailable } that will be converted to the correct
        integer value. </p>


</dl>
<dl><dt><strong>write(data)</strong><dd>
<p>
        Return data as a stream</p>

<p>        HTML data may be returned using a stream-oriented interface.
        This allows the browser to display partial results while
        computation of a response to proceed.</p>

<p>        The published object should first set any output headers or
        cookies on the response object.</p>

<p>        Note that published objects must not generate any errors
        after beginning stream-oriented output.	</p>
<p>        </p>



</dl>
</dl>

<dl><dt><p><strong>General Services Provided by Response</strong></p><dd>

<dl><dt><strong>`aResponse`</strong><dd>
<p>Convert a Response to a string that looks like a Python expression.</p>


</dl>
<dl><dt><strong>str(aResponse)</strong><dd>
<p>Convert a Response to a string.</p>


</dl>
</dl>

<dl><dt><p><strong>Indexing Services Provided by Response</strong></p><dd>

<dl><dt><strong>aResponse[key]</strong><dd>
<p>Get the value of an output header</p>


</dl>
<dl><dt><strong>aResponse[key]=value</strong><dd>
<p>
        Sets an HTTP return header "name" with value "value", clearing
        the previous value set for the header, if one exists. </p>


</dl>
</dl>



<hr>Last Modified: 1 September 1998
</body></html>
